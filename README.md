# Telegram-бот нутрициолог

Проект представляет собой многоcервисный каркас: Telegram-бот помогает пользователю следить за питанием, хранит личные данные в Core API, автоматически генерирует меню на неделю и формирует еженедельные отчёты о прогрессе. Дополнительно используется сервис компьютерного зрения, который оценивает блюда по фотографии и подсчитывает их калорийность и БЖУ.

> ⚠️ Бот не заменяет врача. При наличии хронических заболеваний и любых вопросов по здоровью пользователь обязан консультироваться с профильным специалистом.

## Состав репозитория

- **infra/** — инфраструктурные файлы Docker.
- **core_api/** — FastAPI-приложение, бизнес-логика, БД, планировщик отчётов.
- **vision_service/** — FastAPI-сервис компьютерного зрения на PyTorch/torchvision.
- **tg_bot/** — Telegram-бот на aiogram.

## Запуск локально

1. Скопируйте пример окружения:
   ```bash
   cp infra/.env.example infra/.env
   ```
2. Заполните файл `infra/.env` значениями: токен Telegram-бота, ключи LLM (при необходимости) и параметры подключения к БД.
3. Соберите и поднимите сервисы:
   ```bash
   cd infra
   docker compose up --build
   ```
4. Проверьте документацию Core API: http://localhost:8000/docs.
5. Проверьте документацию Vision Service: http://localhost:8001/docs.
6. Убедитесь, что Telegram-бот запущен, пропишите токен в `.env` и протестируйте команды `/start`, «Меню на неделю», «Мой прогресс», отправку фотографии блюда и получение недельного отчёта.

## Ручной запуск генерации отчёта

Планировщик APScheduler автоматически формирует отчёты раз в сутки. Чтобы форсировать генерацию:

```bash
cd infra
docker compose exec core_api python -m core_api.scripts.manual_report
```

Скрипт пройдётся по всем пользователям и сформирует отчёты за последние 7 дней.

## Стек технологий

- Python 3.11
- FastAPI, aiogram, SQLAlchemy, Pydantic
- PostgreSQL
- APScheduler
- PyTorch и torchvision
- Docker Compose

## Будущее расширение

- **Speech service**: добавить сервис распознавания и генерации речи (например, на базе Yandex SpeechKit) для голосового общения с пользователем.
- **Управляемая БД**: перенести PostgreSQL в управляемый сервис в Яндекс Облаке для повышения отказоустойчивости и масштабируемости.
- **SaaS-модель**: упаковать решение в продукт для фитнес- и wellness-специалистов с многоарендной архитектурой и оплатой по подписке.
